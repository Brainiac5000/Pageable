/*
 Pageable 0.3.7
 http://mobius.ovh/

 Released under the MIT license
*/
"use strict";var _createClass=function(){function f(g,j){for(var l,k=0;k<j.length;k++)l=j[k],l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(g,l.key,l)}return function(g,j,k){return j&&f(g.prototype,j),k&&f(g,k),g}}();Object.defineProperty(exports,"__esModule",{value:!0});function _classCallCheck(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")}var Pageable=function(){function f(g){var m=this,j=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,f),void 0===g)return console.error("Pageable:","No container defined.");var k={pips:!0,interval:300,delay:0,throttle:50,orientation:"vertical",easing:function easing(n,p,q,r){return-q*(n/=r)*(n-2)+p},onInit:function onInit(){},onUpdate:function onUpdate(){},onBeforeStart:function onBeforeStart(){},onStart:function onStart(){},onScroll:function onScroll(){},onFinish:function onFinish(){},swipeThreshold:50,freeScroll:!1,events:{wheel:!0,mouse:!0,touch:!0}};if(this.container="string"==typeof g?document.querySelector(g):g,!this.container)return console.error("Pageable:","The container could not be found.");if(this.config=Object.assign({},k,j),this.events=Object.assign({},k.events,j.events),this.config.anchors&&Array.isArray(this.config.anchors)){var l=document.createDocumentFragment();this.config.anchors.forEach(function(n){var p=document.createElement("div");p.dataset.anchor=n,l.appendChild(p)}),this.container.appendChild(l)}return this.pages=Array.from(this.container.querySelectorAll("[data-anchor]")),this.pages.length?void(this.horizontal="horizontal"===this.config.orientation,this.anchors=[],this.pages.forEach(function(n,p){var q=n.dataset.anchor.replace(/\s+/,"-");n.id!==q&&(n.id=q),m.anchors.push("#"+q),n.classList.add("pg-page"),n.classList.toggle("pg-active",0==p)}),this.axis=this.horizontal?"x":"y",this.mouseAxis={x:"clientX",y:"clientY"},this.scrollAxis={x:"scrollLeft",y:"scrollTop"},this.size={x:"width",y:"height"},this.bar=this.getScrollBarWidth(),this.index=0,this.initialised=!1,this.touch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,this.init()):console.error("Pageable:","No child nodes with the [data-anchor] attribute could be found.")}return _createClass(f,[{key:"init",value:function init(){if(!this.initialised){var g=this.config;this.wrapper=document.createElement("div"),this.container.parentNode.insertBefore(this.wrapper,this.container),this.wrapper.appendChild(this.container),this.wrapper.classList.add("pg-wrapper","pg-"+g.orientation),this.wrapper.classList.add("pg-wrapper"),this.container.classList.add("pg-container"),document.body.style.margin=0,document.body.style.overflow="hidden",this.container.style.display="inline-block",g.freeScroll&&0<g.delay&&(g.delay=0);for(var _arr=["Prev","Next"],j=0;j<_arr.length;j++){dir=_arr[j];var u="nav"+dir+"El";g[u]&&("string"==typeof g[u]?this[u]=document.querySelector(g[u]):g[u]instanceof Element&&(this[u]=g[u]),this[u]&&(this[u].classList.add("pg-nav"),this[u].onclick=this[dir.toLowerCase()].bind(this)))}if(g.pips){var k=document.createElement("nav"),l=document.createElement("ul"),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var n,m=this.pages[Symbol.iterator]();!(_iteratorNormalCompletion=(n=m.next()).done);_iteratorNormalCompletion=!0){page=n.value;var p=document.createElement("li"),q=document.createElement("a"),r=document.createElement("span");q.href="#"+page.id,0==i&&q.classList.add("active"),q.appendChild(r),p.appendChild(q),l.appendChild(p)}}catch(v){_didIteratorError=!0,_iteratorError=v}finally{try{!_iteratorNormalCompletion&&m.return&&m.return()}finally{if(_didIteratorError)throw _iteratorError}}k.appendChild(l),this.wrapper.appendChild(k),this.pips=Array.from(l.children)}this.bind(),this.update(),this.initialised=!0}}},{key:"bind",value:function bind(){var j=this,k=arguments;this.callbacks={wheel:this.wheel.bind(this),update:function g(l,m,n){var p;return function(){if(n=n||j,!p)return l.apply(n,k),p=!0,setTimeout(function(){p=!1},m)}}(this.update.bind(this),this.config.throttle),load:this.load.bind(this),start:this.start.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),click:this.click.bind(this)},this.wrapper.addEventListener("wheel",this.callbacks.wheel,!1),window.addEventListener("resize",this.callbacks.update,!1),this.wrapper.addEventListener(this.touch?"touchstart":"mousedown",this.callbacks.start,!1),window.addEventListener(this.touch?"touchmove":"mousemove",this.callbacks.drag,!1),window.addEventListener(this.touch?"touchend":"mouseup",this.callbacks.stop,!1),document.onreadystatechange=function(){"complete"===document.readyState&&j.load()},document.addEventListener("click",this.callbacks.click,!1)}},{key:"unbind",value:function unbind(){this.wrapper.removeEventListener("wheel",this.callbacks.wheel),window.removeEventListener("resize",this.callbacks.update),this.wrapper.removeEventListener(this.touch?"touchstart":"mousedown",this.callbacks.start),window.addEventListener(this.touch?"touchmove":"mousemove",this.callbacks.drag),window.removeEventListener(this.touch?"touchend":"mouseup",this.callbacks.stop),document.removeEventListener("click",this.callbacks.click)}},{key:"click",value:function click(g){if(g.target.closest){var j=g.target.closest("a");j&&this.anchors.includes(j.hash)&&(g.preventDefault(),this.scrollToAnchor(j.hash))}}},{key:"start",value:function start(g){if(g.preventDefault(),g.stopPropagation(),this.scrolling||this.dragging)return!1;if("touchstart"===g.type&&!this.events.touch)return!1;if("mousedown"===g.type&&!this.events.mouse)return 1===g.button&&g.preventDefault(),!1;var j=this.touch?g.touches[0]:g;return!!j.target.closest("[data-anchor]")&&void(this.dragging=this.config.freeScroll,this.down={x:j.clientX,y:j.clientY},this.config.onBeforeStart.call(this,this.index))}},{key:"drag",value:function drag(g){if(this.config.freeScroll&&this.dragging&&!this.scrolling){var j=this.touch&&"touchmove"===g.type?g.touches[0]:g,k=j[this.mouseAxis[this.axis]]-this.down[this.axis],l=this.getData();this.container.style.transform=this.horizontal?"translate3d("+k+"px, 0, 0)":"translate3d(0, "+k+"px, 0)",l.scrolled-=k,this.config.onScroll.call(this,l),this.emit("scroll",l)}}},{key:"stop",value:function stop(g){var l=this,j=this.touch?g.touches[0]||g.changedTouches[0]:g,k=function(){return l.index<l.pages.length-1&&l.index++},m=function(){return 0<l.index&&l.index--};if(this.dragging&&!this.scrolling){var n=j[this.mouseAxis[this.axis]]-this.down[this.axis],p=this.data.window[this.size[this.axis]],q=this.index,r=Math.abs(j[this.mouseAxis[this.axis]]-this.down[this.axis])>=this.config.swipeThreshold;return this.dragging=n,r&&(0<n?m():k()),this.scrollBy(this.getScrollAmount(q)-n),void(this.down=!1)}if(this.down&&!this.scrolling){var u=this.index,v=Math.abs(j[this.mouseAxis[this.axis]]-this.down[this.axis])>=this.config.swipeThreshold;v&&(this.touch?g.changedTouches[0][this.mouseAxis[this.axis]]<this.down[this.axis]?k():g.changedTouches[0][this.mouseAxis[this.axis]]>this.down[this.axis]&&m():g[this.mouseAxis[this.axis]]<this.down[this.axis]?1===g.button?m():k():g[this.mouseAxis[this.axis]]>this.down[this.axis]&&(1===g.button?k():m())),u===this.index?this.config.onFinish.call(this,this.getData()):(this.oldIndex=u,this.scrollBy(this.getScrollAmount(u))),this.down=!1}}},{key:"wheel",value:function wheel(g){if(g.preventDefault(),this.events.wheel&&!this.scrolling){var j=this.index;0<g.deltaY?this.index<this.pages.length-1&&this.index++:0<this.index&&this.index--,this.index!==j&&(this.oldIndex=j,this.scrollBy(this.getScrollAmount(j)))}}},{key:"load",value:function load(){var m=this,j=location.hash;if(j){var k=this.anchors.indexOf(j);if(-1<k){this.scrollPosition=this.data.window[this.size[this.axis]]*k;var l=this.getData();this.index=k,this.setPips(),this.pages.forEach(function(p,q){p.classList.toggle("pg-active",q===m.index)}),this.navPrevEl&&this.navPrevEl.classList.toggle("active",0<this.index),this.navNextEl&&this.navNextEl.classList.toggle("active",this.index<this.pages.length-1),this.config.onScroll.call(this,l),this.config.onFinish.call(this,l),this.emit("scroll",l)}}this.update();var n=this.getData();this.config.onInit.call(this,n),this.emit("init",n)}},{key:"setPips",value:function setPips(g){this.config.pips&&(void 0===g&&(g=this.index),this.pips.forEach(function(j,k){j.firstElementChild.classList.toggle("active",k==g)}))}},{key:"getScrollAmount",value:function getScrollAmount(g,j){void 0===j&&(j=this.index);var k=this.data.window[this.size[this.axis]],m=k*j;return k*g-m}},{key:"scrollBy",value:function scrollBy(g){var j=this;return!this.scrolling&&void(this.scrolling=!0,this.config.onBeforeStart.call(this,this.oldIndex),this.emit("scroll.before",this.getData()),this.timer=setTimeout(function(){var k=Date.now(),l=j.getScrollOffset();j.setPips();var m=function(){var n=Date.now(),p=n-k;if(p>j.config.interval){cancelAnimationFrame(j.frame);j.data.window[j.size[j.axis]]*j.index;j.container.style.transform="",j.frame=!1,j.scrolling=!1,j.dragging=!1,window.location.hash=j.pages[j.index].id,j.pages.forEach(function(x,y){x.classList.toggle("pg-active",y===j.index)}),j.navPrevEl&&j.navPrevEl.classList.toggle("active",0<j.index),j.navNextEl&&j.navNextEl.classList.toggle("active",j.index<j.pages.length-1);var r=j.getData();return j.config.onFinish.call(j,r),j.emit("scroll.end",r),!1}var u=j.dragging?j.dragging:0,v=j.config.easing(p,u,g,j.config.interval);j.container.style.transform=j.horizontal?"translate3d("+v+"px, 0, 0)":"translate3d(0, "+v+"px, 0)",j.scrollPosition=l[j.axis]-v;var w=j.getData();j.config.onScroll.call(j,w),j.emit("scroll",w),j.frame=requestAnimationFrame(m)};j.config.onStart.call(j,j.pages[j.index].id),j.emit("scroll.start",j.getData()),j.frame=requestAnimationFrame(m)},this.config.delay))}},{key:"scrollToPage",value:function scrollToPage(g){this.scrollToIndex(g-1)}},{key:"scrollToAnchor",value:function scrollToAnchor(g){this.scrollToIndex(this.anchors.indexOf(g))}},{key:"next",value:function next(){this.scrollToIndex(this.index+1)}},{key:"prev",value:function prev(){this.scrollToIndex(this.index-1)}},{key:"scrollToIndex",value:function scrollToIndex(g){if(!this.scrolling&&0<=g&&g<=this.pages.length-1){var j=this.index;this.index=g,this.oldIndex=j,this.scrollBy(this.getScrollAmount(j))}}},{key:"update",value:function update(){var k=this;clearTimeout(this.timer),this.data={window:{width:window.innerWidth,height:window.innerHeight},container:{height:this.wrapper.scrollHeight,width:this.wrapper.scrollWidth}};var g=this.size[this.axis],j=this.horizontal?this.size.y:this.size.x;this.wrapper.style["overflow-"+this.axis]="scroll",this.wrapper.style[g]=this.data.window[g]+"px",this.wrapper.style[j]=this.data.window[j]+this.bar+"px",this.container.style[g]=this.pages.length*this.data.window[g]+"px",this.wrapper.style["padding-"+(this.horizontal?"bottom":"right")]=this.bar+"px",this.wrapper[this.scrollAxis[this.axis]]=this.index*this.data.window[g],this.scrollSize=this.pages.length*this.data.window[g]-this.data.window[g],this.scrollPosition=this.data.window[g]*this.index,this.pages.forEach(function(l){k.horizontal&&(l.style.float="left"),l.style[g]=k.data.window[g]+"px",l.style[j]=k.data.window[j]+"px"}),this.config.onUpdate.call(this,this.getData()),this.emit("update",this.getData())}},{key:"getData",value:function getData(){return{index:this.index,scrolled:this.scrollPosition,max:this.scrollSize}}},{key:"getScrollOffset",value:function getScrollOffset(){return{x:this.wrapper.scrollLeft,y:this.wrapper.scrollTop}}},{key:"orientate",value:function orientate(g){switch(g){case"vertical":this.horizontal=!1,this.axis="y",this.container.style.width="";break;case"horizontal":this.horizontal=!0,this.axis="x",this.container.style.height="";break;default:return!1;}this.wrapper.classList.toggle("pg-vertical",!this.horizontal),this.wrapper.classList.toggle("pg-horizontal",this.horizontal),this.config.orientation=g,this.update()}},{key:"on",value:function on(g,j){this.listeners=this.listeners||{},this.listeners[g]=this.listeners[g]||[],this.listeners[g].push(j)}},{key:"off",value:function off(g,j){this.listeners=this.listeners||{},!1==g in this.listeners||this.listeners[g].splice(this.listeners[g].indexOf(j),1)}},{key:"emit",value:function emit(g){if(this.listeners=this.listeners||{},!1!=g in this.listeners)for(var j=0;j<this.listeners[g].length;j++)this.listeners[g][j].apply(this,Array.prototype.slice.call(arguments,1))}},{key:"destroy",value:function destroy(){if(this.initialised){this.emit("destroy"),this.unbind(),document.body.style.margin="",document.body.style.overflow="",this.container.style.display="",this.container.style.height="",this.container.style.width="",this.container.classList.remove("pg-container"),this.wrapper.parentNode.replaceChild(this.container,this.wrapper);var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var k,l,j=this.pages[Symbol.iterator]();!(_iteratorNormalCompletion2=(k=j.next()).done);_iteratorNormalCompletion2=!0)l=k.value,l.style.height="",l.style.width="",l.classList.remove("pg-page"),l.classList.remove("pg-active")}catch(n){_didIteratorError2=!0,_iteratorError2=n}finally{try{!_iteratorNormalCompletion2&&j.return&&j.return()}finally{if(_didIteratorError2)throw _iteratorError2}}for(var _arr2=["Prev","Next"],g=0;g<_arr2.length;g++){dir=_arr2[g];var m="nav"+dir+"El";o[m]&&this[m]&&(this[m].classList.remove("active"),this[m].classList.remove("pg-nav"),this[m].onclick=function(){})}this.initialised=!1}}},{key:"getScrollBarWidth",value:function getScrollBarWidth(){var g=document.body,j=document.createElement("div"),k=0;return j.style.cssText="width: 100; height: 100; overflow: scroll; position: absolute; top: -9999;",document.body.appendChild(j),k=j.offsetWidth-j.clientWidth,document.body.removeChild(j),k}}]),f}();exports.default=Pageable;